{"version":3,"file":"Annotation.js","sourceRoot":"","sources":["../../../../../src/.internal/plugins/annotation/Annotation.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Plugin which enables annotation functionality for charts.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { fabric } from \"../../fabric/fabric.js\";\r\nimport { AnnotationIcons } from \"./AnnotationIcons\";\r\nimport { Plugin } from \"../../core/utils/Plugin\";\r\nimport { IExportCustomOptions } from \"../../core/export/Export\";\r\nimport { ExportMenu, IExportMenuItem } from \"../../core/export/ExportMenu\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { Color, color } from \"../../core/utils/Color\";\r\nimport { getInteraction } from \"../../core/interaction/Interaction\";\r\nimport { keyboard } from \"../../core/utils/Keyboard\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A plugin which automatically groups [[PercenSeries]] slices that are smaller\r\n * than certain percent into one \"Other\" slice.\r\n *\r\n * By pushing an instance of [[Annnotation]] into `plugin` list of\r\n * any [[Chart]], it automatically applies the functionality.\r\n *\r\n * Example:\r\n *\r\n * ```TypeScript\r\n * let annotation = chart.plugins.push(new am4plugins_annotation.Annotation());\r\n * ```\r\n * ```JavaScript\r\n * let annotation = chart.plugins.push(new am4plugins_annotation.Annotation());\r\n * ```\r\n * ```JSON\r\n * {\r\n *   \"plugins\": [{\r\n *     \"type\": \"Annotation\"\r\n *   }]\r\n * }\r\n * ```\r\n *\r\n * @since 4.5.5\r\n *\r\n * @todo resolve translations\r\n * @todo change mouse cursors based on context/tool\r\n * @todo better line selection on click\r\n * @todo arrow support\r\n * @todo undo/redo\r\n * @todo reposition/resize annotations on chart resize\r\n * @todo make annotations hold on IE (when in not annotation mode)\r\n */\r\nexport class Annotation extends Plugin {\r\n\r\n\t/**\r\n\t * Indicates if Sprite is currently in annotating mode.\r\n\t */\r\n\tprivate _active: boolean = false;\r\n\r\n\t/**\r\n\t * A reference to menu item that holds annotation tools.\r\n\t */\r\n\tprivate _menu: IExportMenuItem;\r\n\r\n\t/**\r\n\t * An ID of an element that represents the currently selected tool indicator.\r\n\t */\r\n\tprivate _indicatorId: string;\r\n\r\n\t/**\r\n\t * Currently selected tool.\r\n\t */\r\n\tprivate _currentTool: string = \"draw\";\r\n\r\n\t/**\r\n\t * Current color in use.\r\n\t */\r\n\tprivate _currentColor: Color = color(\"#c00\");\r\n\r\n\t/**\r\n\t * Currently selected weight/width.\r\n\t */\r\n\tprivate _currentWidth: number = 2;\r\n\r\n\t/**\r\n\t * Currently selected opacity.\r\n\t */\r\n\tprivate _currentOpacity: number = 0.8;\r\n\r\n\t/**\r\n\t * Font size.\r\n\t */\r\n\tprivate _currentFontSize: number = 20;\r\n\r\n\t/**\r\n\t * Font weight.\r\n\t */\r\n\tprivate _currentFontWeight: number = 400;\r\n\r\n\t/**\r\n\t * Color selection.\r\n\t */\r\n\tprivate _colors: Array<Color> = [];\r\n\r\n\t/**\r\n\t * Available line widths.\r\n\t */\r\n\tprivate _widths: Array<number> = [];\r\n\r\n\t/**\r\n\t * Available opacities.\r\n\t */\r\n\tprivate _opacities: Array<number> = [];\r\n\r\n\t/**\r\n\t * Available font sizes.\r\n\t */\r\n\tprivate _fontSizes: Array<number> = [];\r\n\r\n\t/**\r\n\t * Available font weights.\r\n\t */\r\n\tprivate _fontWeights: Array<number> = [];\r\n\r\n\t/**\r\n\t * A Fabric's Canvas element.\r\n\t *\r\n\t * @see {@link http://fabricjs.com/docs/fabric.Canvas.html}\r\n\t */\r\n\tprivate _fabric: fabric.Canvas;\r\n\r\n\t/**\r\n\t * Reference to `<g>` element that holds annotation objects.\r\n\t */\r\n\tprivate _group: SVGGElement;\r\n\r\n\tprivate _pointerDown: boolean = false;\r\n\tprivate _currentLine: any;\r\n\tprivate _data: any;\r\n\tprivate _exportInited: boolean = false;\r\n\r\n\t/**\r\n\t * List of icons to use in annotation\r\n\t */\r\n\tpublic icons: Array<string> = [];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\t// Nothing to do here\r\n\t\tsuper();\r\n\r\n\t\t// Set default colors\r\n\t\tthis._colors = [\r\n\t\t\tcolor(\"#000\"),\r\n\t\t\tcolor(\"#fff\"),\r\n\t\t\tcolor(\"#c00\"),\r\n\t\t\tcolor(\"#0c0\"),\r\n\t\t\tcolor(\"#00c\")\r\n\t\t];\r\n\r\n\t\t// Set defaults\r\n\t\tthis._widths = [1, 2, 4, 10];\r\n\t\tthis._opacities = [0.2, 0.4, 0.6, 0.8, 1];\r\n\r\n\t\t// Set default font sizes\r\n\t\tthis._fontSizes = [10, 15, 20, 30];\r\n\t\tthis._fontWeights = [200, 300, 400, 800];\r\n\r\n\t\t// Add default icons\r\n\t\tthis.icons = [\r\n\t\t\tAnnotationIcons.pin,\r\n\t\t\tAnnotationIcons.heart,\r\n\t\t\tAnnotationIcons.check,\r\n\t\t\tAnnotationIcons.like,\r\n\t\t\tAnnotationIcons.dislike,\r\n\t\t\tAnnotationIcons.tag,\r\n\t\t\tAnnotationIcons.attention,\r\n\t\t\tAnnotationIcons.smiley\r\n\t\t];\r\n\t}\r\n\r\n\tpublic init() {\r\n\t\tsuper.init();\r\n\t\tthis.initExporting();\r\n\t\tif (this._data) {\r\n\t\t\tthis.loadData();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes menus for the annotation.\r\n\t *\r\n\t * Will try to use existing [[ExportMenu]] if present.\r\n\t */\r\n\tprotected initExporting(): void {\r\n\t\tconst target = this.target;\r\n\r\n\t\t// Create an export menu if it does not yet exist\r\n\t\tif (!target.exporting.menu) {\r\n\t\t\ttarget.exporting.menu = new ExportMenu();\r\n\t\t\ttarget.exporting.menu.items[0].menu = [];\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttarget.exporting.menu.invalidate();\r\n\t\t}\r\n\r\n\t\t// Create DEL key handler\r\n\t\tgetInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\tif (this.active && keyboard.isKey(ev.event, \"del\")) {\r\n\t\t\t\tthis.deleteSelected();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Update indicator when menu is created\r\n\t\ttarget.exporting.events.once(\"menucreated\", this.updateIndicator);\r\n\r\n\t\t// Update/show SVG annotation if currently in annotation mode and user\r\n\t\t// triggers export.\r\n\t\ttarget.exporting.events.on(\"exportstarted\", (ev) => {\r\n\t\t\tif (this.active) {\r\n\t\t\t\tthis.updateSVG();\r\n\t\t\t\t(<any>this).fabric.wrapperEl.style.display = \"none\";\r\n\t\t\t\tthis._group.style.display = \"\";\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\ttarget.exporting.events.on(\"exportfinished\", (ev) => {\r\n\t\t\tif (this.active) {\r\n\t\t\t\tthis._group.style.display = \"none\";\r\n\t\t\t\t(<any>this).fabric.wrapperEl.style.display = \"block\";\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Generate a unique id for indicator\r\n\t\tthis._indicatorId = registry.getUniqueId();\r\n\r\n\t\t// Add annotation menu\r\n\t\ttarget.exporting.menu.items[0].menu.push({\r\n\t\t\tlabel: target.language.translateAny(\"Annotate\"),\r\n\t\t\ttype: \"custom\",\r\n\t\t\toptions: {\r\n\t\t\t\tcallback: this.handleClick,\r\n\t\t\t\tcallbackTarget: this\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Color list\r\n\t\tlet colors: Array<IExportMenuItem> = [];\r\n\t\tfor (let i = 0; i < this.colors.length; i++) {\r\n\t\t\tcolors.push({\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.ok,\r\n\t\t\t\tcolor: this.colors[i],\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tcallback: () => {\r\n\t\t\t\t\t\tthis.setColor(this.colors[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Width list\r\n\t\tlet widths: Array<IExportMenuItem> = [];\r\n\t\tfor (let i = 0; i < this.widths.length; i++) {\r\n\t\t\twidths.push({\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tlabel: this.widths[i] + \"px\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tcallback: () => {\r\n\t\t\t\t\t\tthis.setWidth(this.widths[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Opacity list\r\n\t\tlet opacities: Array<IExportMenuItem> = [];\r\n\t\tfor (let i = 0; i < this.opacities.length; i++) {\r\n\t\t\topacities.push({\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tlabel: \"<span style=\\\"opacity: \" + this.opacities[i] + \"\\\">\" + (this.opacities[i] * 100) + \"%</span>\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tcallback: () => {\r\n\t\t\t\t\t\tthis.setOpacity(this.opacities[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Font sizes\r\n\t\tlet fontSizes: Array<IExportMenuItem> = [];\r\n\t\tfor (let i = 0; i < this.fontSizes.length; i++) {\r\n\t\t\tfontSizes.push({\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tlabel: \"\" + this.fontSizes[i],\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tcallback: () => {\r\n\t\t\t\t\t\tthis.setFontSize(this.fontSizes[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Font weights\r\n\t\tlet fontWeights: Array<IExportMenuItem> = [];\r\n\t\tfor (let i = 0; i < this.fontWeights.length; i++) {\r\n\t\t\tfontWeights.push({\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tlabel: \"\" + this.fontWeights[i],\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tcallback: () => {\r\n\t\t\t\t\t\tthis.setFontWeight(this.fontWeights[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Icons\r\n\t\tlet icons: Array<IExportMenuItem> = [];\r\n\t\tfor (let i = 0; i < this.icons.length; i++) {\r\n\t\t\ticons.push({\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: this.icons[i],\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tcallback: () => {\r\n\t\t\t\t\t\tthis.addIcon(this.icons[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Construct main menu item\r\n\t\tconst id = this._indicatorId;\r\n\t\t//let mainitem = this.target.exporting.menu.createSvgElement(0, \"custom\", AnnotationIcons.select).outerHTML;\r\n\t\tlet mainitem = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" version=\\\"1\\\" viewBox=\\\"0 0 24 24\\\"></svg>\";\r\n\t\tmainitem += \"<span class=\\\"\" + id + \"_color\\\" style=\\\"display: block; background-color: \" + this.currentColor.hex + \"; width: 1.2em; height: 1.2em; margin: 0.2em auto 0.4em auto;\\\"></span>\";\r\n\r\n\t\t// Add annotation tools menu\r\n\t\tthis._menu = {\r\n\t\t\thidden: !this.active,\r\n\t\t\t// icon: AnnotationIcons.select,\r\n\t\t\tlabel: mainitem,\r\n\t\t\tid: this._indicatorId,\r\n\t\t\tmenu: [{\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.tools,\r\n\t\t\t\tlabel: target.language.translateAny(\"Tools\"),\r\n\t\t\t\tmenu: [{\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.select,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Select\"),\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tcallback: this.select,\r\n\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t}\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.draw,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Draw\"),\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tcallback: this.draw,\r\n\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t}\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.line,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Line\"),\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tcallback: this.line,\r\n\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t}\r\n\t\t\t\t}/*, {\r\n\t\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\t\tsvg: AnnotationIcons.arrow,\r\n\t\t\t\t\t\tlabel: target.language.translateAny(\"Arrow\"),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tcallback: this.underConstruction,\r\n\t\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}*/, {\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.width,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Weight\"),\r\n\t\t\t\t\tmenu: widths\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.delete,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Delete\"),\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tcallback: this.delete,\r\n\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}, {\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.text,\r\n\t\t\t\tlabel: target.language.translateAny(\"Text\"),\r\n\t\t\t\tmenu: [{\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.textAdd,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Add\"),\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tcallback: this.addText,\r\n\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t}\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.textWeight,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Weight\"),\r\n\t\t\t\t\tmenu: fontWeights\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\tsvg: AnnotationIcons.textSize,\r\n\t\t\t\t\tlabel: target.language.translateAny(\"Size\"),\r\n\t\t\t\t\tmenu: fontSizes\r\n\t\t\t\t}]\r\n\t\t\t}, {\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.colors,\r\n\t\t\t\tlabel: target.language.translateAny(\"Color\"),\r\n\t\t\t\tmenu: colors\r\n\t\t\t}, {\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.opacity,\r\n\t\t\t\tlabel: target.language.translateAny(\"Opacity\"),\r\n\t\t\t\tmenu: opacities\r\n\t\t\t}, {\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.icon,\r\n\t\t\t\tlabel: target.language.translateAny(\"Icon\"),\r\n\t\t\t\tmenu: icons\r\n\t\t\t}, {\r\n\t\t\t\ttype: \"custom\",\r\n\t\t\t\tsvg: AnnotationIcons.more,\r\n\t\t\t\tlabel: target.language.translateAny(\"More\"),\r\n\t\t\t\tmenu: [/*{\r\n\t\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\t\tsvg: AnnotationIcons.undo,\r\n\t\t\t\t\t\tlabel: target.language.translateAny(\"Undo\"),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tcallback: this.underConstruction,\r\n\t\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\t\tsvg: AnnotationIcons.redo,\r\n\t\t\t\t\t\tlabel: target.language.translateAny(\"Redo\"),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tcallback: this.underConstruction,\r\n\t\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, */{\r\n\t\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\t\tsvg: AnnotationIcons.done,\r\n\t\t\t\t\t\tlabel: target.language.translateAny(\"Done\"),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tcallback: this.deactivate,\r\n\t\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\ttype: \"custom\",\r\n\t\t\t\t\t\tsvg: AnnotationIcons.discard,\r\n\t\t\t\t\t\tlabel: target.language.translateAny(\"Discard\"),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tcallback: this.discard,\r\n\t\t\t\t\t\t\tcallbackTarget: this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}]\r\n\t\t\t}]\r\n\t\t};\r\n\t\ttarget.exporting.menu.items.push(this._menu);\r\n\r\n\t\tthis._exportInited = true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Toggles annotation mode on click of the related menu item.\r\n\t *\r\n\t * @ignore\r\n\t * @param  options  Options\r\n\t */\r\n\tpublic handleClick(options: IExportCustomOptions): void {\r\n\t\tthis.active = !this.active;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an instance of Fabric's `Canvas`.\r\n\t * @return Canvas\r\n\t */\r\n\tpublic get fabric(): fabric.Canvas {\r\n\t\t// Init canvas if not yet done\r\n\t\tif (!this._fabric) {\r\n\r\n\t\t\t// Creae <canvas> element\r\n\t\t\tlet canvas = document.createElement(\"canvas\");\r\n\t\t\tcanvas.width = this.target.pixelWidth;\r\n\t\t\tcanvas.height = this.target.pixelHeight;\r\n\t\t\tcanvas.style.position = \"absolute\";\r\n\t\t\tcanvas.style.top = \"0\";\r\n\t\t\tcanvas.style.left = \"0\";\r\n\t\t\tthis.target.svgContainer.SVGContainer.appendChild(canvas);\r\n\r\n\t\t\t// Create Fabric representation of the canvas\r\n\t\t\tthis._fabric = new fabric.Canvas(canvas, {\r\n\t\t\t\t//isDrawingMode: true,\r\n\t\t\t\tcontainerClass: \"am4plugins_annotation_canvas_container\"\r\n\t\t\t});\r\n\t\t\t(<any>this).fabric.wrapperEl.style.position = \"absolute\";\r\n\t\t\t(<any>this).fabric.wrapperEl.style.top = \"0\";\r\n\t\t\t(<any>this).fabric.wrapperEl.style.left = \"0\";\r\n\r\n\t\t\t// Set up events for deletion\r\n\t\t\tthis.fabric.on(\"selection:created\", (ev) => {\r\n\t\t\t\tif (this.currentTool == \"delete\") {\r\n\t\t\t\t\tthis.deleteSelected();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Set up events for drawing lines\r\n\t\t\tthis._fabric.on(\"mouse:down\", (ev) => {\r\n\t\t\t\tif (this.currentTool != \"line\") {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._pointerDown = true;\r\n\t\t\t\tlet pointer = this._fabric.getPointer(ev.e);\r\n\t\t\t\tlet points = [pointer.x, pointer.y, pointer.x, pointer.y];\r\n\r\n\t\t\t\tthis._currentLine = new fabric.Line(points, {\r\n\t\t\t\t\tstrokeWidth: this.currentWidth,\r\n\t\t\t\t\tfill: this.currentColor.hex,\r\n\t\t\t\t\tstroke: this.currentColor.hex,\r\n\t\t\t\t\topacity: this.currentOpacity,\r\n\t\t\t\t\toriginX: \"center\",\r\n\t\t\t\t\toriginY: \"center\"\r\n\t\t\t\t});\r\n\t\t\t\tthis._fabric.add(this._currentLine);\r\n\t\t\t});\r\n\r\n\t\t\tthis._fabric.on(\"mouse:move\", (ev) => {\r\n\t\t\t\tif (!this._pointerDown || this.currentTool != \"line\") {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet pointer = this._fabric.getPointer(ev.e);\r\n\t\t\t\tthis._currentLine.set({ x2: pointer.x, y2: pointer.y });\r\n\t\t\t\tthis._fabric.renderAll();\r\n\t\t\t});\r\n\r\n\t\t\tthis._fabric.on(\"mouse:up\", (ev) => {\r\n\t\t\t\tthis._pointerDown = false;\r\n\t\t\t});\r\n\r\n\t\t\t// Load data if necessary\r\n\t\t\tif (this._data) {\r\n\t\t\t\tthis.loadData();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._fabric;\r\n\t}\r\n\r\n\t/**\r\n\t * A `<g>` that holds SVG representation of the annotations in chart overlay.\r\n\t *\r\n\t * @return  Group element\r\n\t */\r\n\tpublic get group(): SVGGElement {\r\n\t\tif (!this._group) {\r\n\t\t\t//this.group = this.target.svgContainer.container.dom.appendChild(document.createElement(\"g\"));\r\n\t\t\tthis._group = this.target.paper.add(\"g\").node;\r\n\t\t\tthis._group.style.pointerEvents = \"none\";\r\n\t\t\tthis.target.svgContainer.container.dom.appendChild(this._group);\r\n\t\t}\r\n\t\treturn this._group;\r\n\t}\r\n\r\n\t/**\r\n\t * Activates annotation mode.\r\n\t */\r\n\tpublic activate(): void {\r\n\t\tthis.active = true;\r\n\t\tthis.updateTool();\r\n\t\t(<any>this).fabric.wrapperEl.style.display = \"block\";\r\n\t\tthis.group.style.display = \"none\";\r\n\t}\r\n\r\n\t/**\r\n\t * Deactivates annotation mode.\r\n\t */\r\n\tpublic deactivate(): void {\r\n\t\tthis.active = false;\r\n\t\tthis.updateTool();\r\n\t\t(<any>this).fabric.wrapperEl.style.display = \"none\";\r\n\t\tthis.updateSVG();\r\n\t\tthis.group.style.display = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Updates SVG overlay to display annotations when in non-annotation mode.\r\n\t *\r\n\t * @todo Set contents properly (not use innerHTML)\r\n\t */\r\n\tprivate updateSVG(): void {\r\n\t\tlet svg = this.fabric.toSVG();\r\n\t\tconst matches = svg.replace(/[\\n\\r]*/g, \"\").match(/<g.*<\\/g>/g);\r\n\t\tif (matches) {\r\n\t\t\tthis.group.innerHTML = matches[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.group.innerHTML = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Seting to `true` puts the chart in annotation mode.\r\n\t *\r\n\t * Setting to `false` returns chart to regular mode of operation.\r\n\t *\r\n\t * @default false\r\n\t * @param  value  Active?\r\n\t */\r\n\tpublic set active(value: boolean) {\r\n\t\tif (this._active != value) {\r\n\t\t\tthis._active = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.activate();\r\n\t\t\t\tthis.target.exporting.menu.showBranch(this._menu);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.deactivate();\r\n\t\t\t\tthis.target.exporting.menu.hideBranch(this._menu);\r\n\t\t\t}\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Active?\r\n\t */\r\n\tpublic get active(): boolean {\r\n\t\treturn this._active;\r\n\t}\r\n\r\n\t/**\r\n\t * Currently selected color.\r\n\t *\r\n\t * @default #000\r\n\t * @param  value  Color\r\n\t */\r\n\tpublic set currentColor(value: Color) {\r\n\t\tif (this._currentColor != value) {\r\n\t\t\tthis._currentColor = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Color\r\n\t */\r\n\tpublic get currentColor(): Color {\r\n\t\treturn this._currentColor;\r\n\t}\r\n\r\n\t/**\r\n\t * List of colors to show in selection.\r\n\t *\r\n\t * @param  value  Colors\r\n\t */\r\n\tpublic set colors(value: Array<Color>) {\r\n\t\tif (this._colors != value) {\r\n\t\t\tthis._colors = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t\tthis.setColor(this._currentColor);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Colors\r\n\t */\r\n\tpublic get colors(): Array<Color> {\r\n\t\treturn this._colors;\r\n\t}\r\n\r\n\t/**\r\n\t * Currently selected width.\r\n\t *\r\n\t * @default 1\r\n\t * @param  value  Width\r\n\t */\r\n\tpublic set currentWidth(value: number) {\r\n\t\tif (this._currentWidth != value) {\r\n\t\t\tthis._currentWidth = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t\tthis.setWidth(this._currentWidth);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Width\r\n\t */\r\n\tpublic get currentWidth(): number {\r\n\t\treturn this._currentWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * List of widths in pixels for line and free-draw tool.\r\n\t *\r\n\t * @param  value  Widths\r\n\t */\r\n\tpublic set widths(value: Array<number>) {\r\n\t\tif (this._widths != value) {\r\n\t\t\tthis._widths = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Widths\r\n\t */\r\n\tpublic get widths(): Array<number> {\r\n\t\treturn this._widths;\r\n\t}\r\n\r\n\t/**\r\n\t * Currently selected opacity.\r\n\t *\r\n\t * @default 1\r\n\t * @param  value  Opacity\r\n\t */\r\n\tpublic set currentOpacity(value: number) {\r\n\t\tif (this._currentOpacity != value) {\r\n\t\t\tthis._currentOpacity = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t\tthis.setOpacity(this._currentOpacity);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity\r\n\t */\r\n\tpublic get currentOpacity(): number {\r\n\t\treturn this._currentOpacity;\r\n\t}\r\n\r\n\t/**\r\n\t * List of opacities available for selection.\r\n\t *\r\n\t * @param  value  Opacities\r\n\t */\r\n\tpublic set opacities(value: Array<number>) {\r\n\t\tif (this._opacities != value) {\r\n\t\t\tthis._opacities = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacities\r\n\t */\r\n\tpublic get opacities(): Array<number> {\r\n\t\treturn this._opacities;\r\n\t}\r\n\r\n\t/**\r\n\t * Currently selected font size.\r\n\t *\r\n\t * @default 10\r\n\t * @param  value  Font size\r\n\t */\r\n\tpublic set currentFontSize(value: number) {\r\n\t\tif (this._currentFontSize != value) {\r\n\t\t\tthis._currentFontSize = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t\tthis.setFontSize(this._currentFontSize);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font size\r\n\t */\r\n\tpublic get currentFontSize(): number {\r\n\t\treturn this._currentFontSize;\r\n\t}\r\n\r\n\t/**\r\n\t * List of available font sizes.\r\n\t *\r\n\t * @param  value  Font sizes\r\n\t */\r\n\tpublic set fontSizes(value: Array<number>) {\r\n\t\tif (this._fontSizes != value) {\r\n\t\t\tthis._fontSizes = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font sizes\r\n\t */\r\n\tpublic get fontSizes(): Array<number> {\r\n\t\treturn this._fontSizes;\r\n\t}\r\n\r\n\t/**\r\n\t * Currently selected font weight.\r\n\t *\r\n\t * @default 400\r\n\t * @param  value  Font weight\r\n\t */\r\n\tpublic set currentFontWeight(value: number) {\r\n\t\tif (this._currentFontWeight != value) {\r\n\t\t\tthis._currentFontWeight = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t\t//this.setFontWeight(this._currentFontWeight);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font weight\r\n\t */\r\n\tpublic get currentFontWeight(): number {\r\n\t\treturn this._currentFontWeight;\r\n\t}\r\n\r\n\t/**\r\n\t * List of available font weights.\r\n\t *\r\n\t * @param  value  Font weights\r\n\t */\r\n\tpublic set fontWeights(value: Array<number>) {\r\n\t\tif (this._fontWeights != value) {\r\n\t\t\tthis._fontWeights = value;\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font weights\r\n\t */\r\n\tpublic get fontWeights(): Array<number> {\r\n\t\treturn this._fontWeights;\r\n\t}\r\n\r\n\t/**\r\n\t * Currently selected tool.\r\n\t *\r\n\t * @default select\r\n\t * @param  value  Tool\r\n\t */\r\n\tpublic set currentTool(value: string) {\r\n\t\tif (this._currentTool != value) {\r\n\t\t\tthis._currentTool = value;\r\n\t\t\tthis.updateTool();\r\n\t\t\tthis.updateIndicator();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tool\r\n\t */\r\n\tpublic get currentTool(): string {\r\n\t\treturn this._currentTool;\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates tool.\r\n\t */\r\n\tprivate updateTool(): void {\r\n\t\tswitch (this.currentTool) {\r\n\t\t\tcase \"select\":\r\n\t\t\t\tthis.select();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"draw\":\r\n\t\t\t\tthis.draw();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete\":\r\n\t\t\t\tthis.delete();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates currently selected tool/color indicator.\r\n\t */\r\n\tprivate updateIndicator(): void {\r\n\t\tif (this.indicator) {\r\n\r\n\t\t\t// Update tool icon\r\n\t\t\tlet container = this.indicator.getElementsByTagName(\"a\")[0];\r\n\t\t\tlet newicon = this.target.exporting.menu.createSvgElement(0, \"custom\", (<any>AnnotationIcons)[this.currentTool]);\r\n\t\t\tlet oldicon = this.indicator.getElementsByTagName(\"svg\")[0];\r\n\t\t\tcontainer.insertBefore(newicon, oldicon);\r\n\t\t\tcontainer.removeChild(oldicon);\r\n\r\n\t\t\t// Update color\r\n\t\t\t(<any>this.indicator.getElementsByClassName(this._indicatorId + \"_color\"))[0].style.backgroundColor = this.currentColor.hex;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Current tool/color indicator element.\r\n\t *\r\n\t * @return  Indicator\r\n\t */\r\n\tpublic get indicator(): HTMLElement {\r\n\t\treturn document.getElementById(this._indicatorId);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets color.\r\n\t *\r\n\t * @param  value  Color\r\n\t */\r\n\tpublic setColor(value: Color): void {\r\n\t\tthis.currentColor = value;\r\n\r\n\t\tlet brushColor = color(value);\r\n\t\tbrushColor.alpha = this.currentOpacity;\r\n\t\tthis.fabric.freeDrawingBrush.color = brushColor.rgba;\r\n\r\n\t\t// Update selected objects\r\n\t\tlet selected = this.fabric.getActiveObjects();\r\n\t\tfor (let i = 0; i < selected.length; i++) {\r\n\t\t\tif ((<any>selected[i]).isType(\"textbox\") || ((<any>selected[i]).isType(\"path\") && selected[i].fill)) {\r\n\t\t\t\tselected[i].set(\"fill\", value.hex);\r\n\t\t\t}\r\n\t\t\telse if ((<any>selected[i]).getSrc) {\r\n\t\t\t\tthis.setIconFill(<fabric.Image>selected[i]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tselected[i].set(\"stroke\", value.hex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.fabric.requestRenderAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets line width.\r\n\t *\r\n\t * @param  value  Width\r\n\t */\r\n\tpublic setWidth(value: number): void {\r\n\t\tthis.currentWidth = value;\r\n\t\tthis.fabric.freeDrawingBrush.width = value;\r\n\r\n\t\t// Update selected objects\r\n\t\tlet selected = this.fabric.getActiveObjects();\r\n\t\tfor (let i = 0; i < selected.length; i++) {\r\n\t\t\tselected[i].set(\"strokeWidth\", value);\r\n\t\t}\r\n\t\tthis.fabric.requestRenderAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets opacity.\r\n\t *\r\n\t * @param  value  Opacity\r\n\t */\r\n\tpublic setOpacity(value: number): void {\r\n\t\tthis.currentOpacity = value;\r\n\r\n\t\tlet brushColor = color(this.currentColor);\r\n\t\tbrushColor.alpha = this.currentOpacity;\r\n\t\tthis.fabric.freeDrawingBrush.color = brushColor.rgba;\r\n\r\n\t\t// Update selected objects\r\n\t\tlet selected = this.fabric.getActiveObjects();\r\n\t\tfor (let i = 0; i < selected.length; i++) {\r\n\t\t\tif (selected[i].isType(\"path\")) {\r\n\t\t\t\tselected[i].set(\"stroke\", this.currentColor.hex);\r\n\t\t\t}\r\n\t\t\tselected[i].set(\"opacity\", value);\r\n\t\t}\r\n\t\tthis.fabric.requestRenderAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets font size.\r\n\t *\r\n\t * @param  value  Font size\r\n\t */\r\n\tpublic setFontSize(value: number): void {\r\n\t\tthis.currentFontSize = value;\r\n\r\n\t\t// Update selected objects\r\n\t\tlet selected = this.fabric.getActiveObjects();\r\n\t\tfor (let i = 0; i < selected.length; i++) {\r\n\t\t\tif ((<any>selected[i]).text) {\r\n\t\t\t\t(<any>selected[i]).set(\"fontSize\", value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.fabric.requestRenderAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets font weight.\r\n\t *\r\n\t * @param  value  Font weight\r\n\t */\r\n\tpublic setFontWeight(value: number): void {\r\n\t\tthis.currentFontWeight = value;\r\n\r\n\t\t// Update selected objects\r\n\t\tlet selected = this.fabric.getActiveObjects();\r\n\t\tfor (let i = 0; i < selected.length; i++) {\r\n\t\t\tif ((<any>selected[i]).text) {\r\n\t\t\t\t(<any>selected[i]).set(\"fontWeight\", value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.fabric.requestRenderAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Does nothing.\r\n\t */\r\n\tpublic underConstruction(): void {\r\n\t\talert(\"This feature is not yet implemented\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts annotator in object selection mode.\r\n\t */\r\n\tpublic select(): void {\r\n\t\tthis.currentTool = \"select\";\r\n\t\tthis.fabric.isDrawingMode = false;\r\n\t\tthis.fabric.selection = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Puts annotator in free-drawing mode.\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tthis.currentTool = \"draw\";\r\n\t\tthis.fabric.isDrawingMode = true;\r\n\t\tthis.fabric.selection = false;\r\n\r\n\t\tlet brushColor = color(this.currentColor);\r\n\t\tbrushColor.alpha = this.currentOpacity;\r\n\t\tthis.fabric.freeDrawingBrush.color = brushColor.rgba;\r\n\t\tthis.fabric.freeDrawingBrush.width = this.currentWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Puts annotator in line drawing mode.\r\n\t */\r\n\tpublic line(): void {\r\n\t\tthis.currentTool = \"line\";\r\n\t\tthis.fabric.isDrawingMode = false;\r\n\t\tthis.fabric.selection = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an editable text object to canvas.\r\n\t */\r\n\tpublic addText(): void {\r\n\t\tthis.fabric.isDrawingMode = false;\r\n\t\tthis.fabric.selection = true;\r\n\t\tthis.select();\r\n\t\tlet text = new fabric.Textbox(this.target.language.translateAny(\"Type...\"), {\r\n\t\t\t//left: this.target.pixelWidth / 2,\r\n\t\t\t//top: this.target.pixelHeight / 2,\r\n\t\t\tfontSize: this.currentFontSize,\r\n\t\t\tfontWeight: this.currentFontWeight,\r\n\t\t\tfill: this.currentColor.hex,\r\n\t\t\topacity: this.currentOpacity\r\n\t\t});\r\n\t\tthis.fabric.add(text);\r\n\t\tthis.fabric.centerObject(text);\r\n\t\ttext.enterEditing();\r\n\t\ttext.selectAll();\r\n\t\tthis.fabric.setActiveObject(text);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an image to canvas.\r\n\t */\r\n\tpublic addIcon(url: string): void {\r\n\t\tthis.fabric.isDrawingMode = false;\r\n\t\tthis.fabric.selection = true;\r\n\t\tthis.select();\r\n\r\n\t\tfabric.loadSVGFromString(url, (res) => {\r\n\t\t\tfor (let i = 0; i < res.length; i++) {\r\n\t\t\t\tthis.fabric.add(res[i]);\r\n\t\t\t\tthis.fabric.centerObject(res[i]);\r\n\t\t\t\tthis.fabric.setActiveObject(res[i]);\r\n\t\t\t\tthis.fabric.setActiveObject(res[i]);\r\n\t\t\t\tres[i].opacity = this.currentOpacity;\r\n\t\t\t\tres[i].fill = this.currentColor.hex;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// fabric.Image.fromElement(element, (img: any) => {\r\n\t\t// \tconsole.log(img)\r\n\t\t// \tthis.fabric.add(img);\r\n\t\t// \tthis.fabric.centerObject(img);\r\n\t\t// \tthis.fabric.setActiveObject(img);\r\n\t\t// \t// img.fill = this.currentColor.hex;\r\n\t\t// \t//this.fabric.requestRenderAll();\r\n\t\t// \timg.opacity = this.currentOpacity;\r\n\t\t// \tthis.setIconFill(img);\r\n\t\t// });\r\n\t}\r\n\r\n\t/**\r\n\t * Attemps to set a fill to the SVG icon.\r\n\t * @param  img  Fabric image reference\r\n\t */\r\n\tpublic setIconFill(img: fabric.Image): void {\r\n\t\tlet src = img.getSrc();\r\n\t\tlet svg = \"\";\r\n\t\tif (src.match(/;base64\\,/)) {\r\n\t\t\ttry {\r\n\t\t\t\tsvg = atob(src.replace(/^.*;base64\\,/g, \"\"));\r\n\t\t\t\tsvg = svg.replace(/fill=\"[^\"]+\"/, \"\");\r\n\t\t\t\tsvg = svg.replace(/\\/>/g, \" fill=\\\"\" + this.currentColor.hex + \"\\\" \\/>\");\r\n\t\t\t\tsrc = src.replace(/(^.*;base64\\,).*$/, \"$1\") + btoa(svg);\r\n\t\t\t\timg.setSrc(src);\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (src.match(/^data:/)) {\r\n\t\t\tsvg = src.replace(/^data:[^,]*\\,/, \"\");\r\n\t\t\tsvg = svg.replace(/fill=\"[^\"]+\"/, \"\");\r\n\t\t\tsvg = svg.replace(/\\/>/g, \" fill=\\\"\" + this.currentColor.hex + \"\\\" \\/>\");\r\n\t\t\tsrc = src.replace(/(^.*;base64\\,).*$/, \"$1\") + svg;\r\n\t\t\timg.setSrc(src);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Puts annotator in object deletion mode\r\n\t */\r\n\tpublic delete(): void {\r\n\t\tthis.currentTool = \"delete\";\r\n\t\tthis.fabric.isDrawingMode = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Clears all annotations.\r\n\t */\r\n\tpublic clear(): void {\r\n\t\tthis.fabric.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Clears all annotations and exits annotation mode.\r\n\t */\r\n\tpublic discard(): void {\r\n\t\tthis.fabric.clear();\r\n\t\tthis.updateSVG();\r\n\t\tthis.deactivate();\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes selected objects\r\n\t */\r\n\tpublic deleteSelected(): void {\r\n\t\tlet selected = this.fabric.getActiveObjects();\r\n\t\tfor (let i = 0; i < selected.length; i++) {\r\n\t\t\tthis.fabric.remove(selected[i]);\r\n\t\t}\r\n\t\tthis.fabric.requestRenderAll();\r\n\t}\r\n\r\n\t/**\r\n\t * Set or get annotation data.\r\n\t *\r\n\t * @since 4.5.6\r\n\t * @param  value  Data\r\n\t */\r\n\tpublic set data(value: any) {\r\n\t\tthis._data = value;\r\n\t\tif (this._fabric || this._exportInited) {\r\n\t\t\t// Canvas is ready, update now\r\n\t\t\tthis.loadData();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Canvas is not yeat ready, just save data for later\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Data\r\n\t */\r\n\tpublic get data(): any {\r\n\t\tif (this._fabric) {\r\n\t\t\treturn this.fabric.toObject();\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._data;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Loads data onto canvas.\r\n\t */\r\n\tprivate loadData(): void {\r\n\t\tthis.fabric.loadFromJSON(this._data, (e: any) => {\r\n\t\t\tthis.updateSVG();\r\n\t\t\tthis._data = undefined;\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Annotation\"] = Annotation;\r\n"]}